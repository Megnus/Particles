<!-- <canvas id="pixel01" width="1000" height="1000" ></canvas> -->
<canvas id="Canvas" style="border:1px solid #000000;" height="800" width="1280">
<script language="Javascript">
	//hspeed and vspeed are﻿ added to the X and Y position at the end of the loop.
	/*
		float dir = atan2(x - mx, y - my) / PI * 180;
		hspeed += -sin (dir*PI/180) / 30;
		vspeed += -cos (dir*PI/180) / 30;
		hspeed and vspeed are﻿ added to the X and Y position at the end of the loop.
	*/

	var canvass = document.getElementById('Canvas');
	var c = canvass.getContext('2d');

	var data;// = c.createImageData(1000,1000);

	var dir = 0;
	var mx = 500;
	var my = 500;

	var particle = new Array();
	var mouseDown = false;

	//init();
	window.onload = init;

	// Converts image to canvas; returns new canvas element
	function convertImageToCanvas(image) {

	  var canvas = document.createElement("canvas");
	  canvas.width = image.width;
	  canvas.height = image.height;
	  console.log(image);
	  canvas.getContext("2d").drawImage(image, 0, 0);

	  return canvas;
	}

	function init() {
		var image = new Image();
		image.src = 'panagora.png';
		var canvas = convertImageToCanvas(image); //document.createElement('canvas');
		var ctx    = canvas.getContext('2d');

		// 2) Copy your image data into the canvas
		var myImgElement = document.getElementById('Canvas');
		ctx.drawImage( myImgElement, 0, 0 );

		// 3) Read your image data
		var w = myImgElement.width, h=myImgElement.height;
		console.log(1)
		var imgdata = ctx.getImageData(0,0,w,h);

		data = imgdata;
		data.width = w;


		for (var x = 0; x < w - 1; x++)
			for (var y = 0; y < h - 1; y++){
				if (getPixel(x,y)[0] == 255)
					particle.push([[x, y],[Math.random()*0,Math.random()*1]]);
			}
		//document.getElementById('Canvas').getContext('2d').putImageData(rgba, 0, 0);
		//data = rgba;


		//var img = new imageClass();
		canvas.onmouseover=function(event){
			mx = event.clientX - 35;
			my = event.clientY - 35;
		};
		console.log(mx,my);
		document.body.style.backgroundColor="#000";
		/*for ( var i = 0; i < 7817; i++) {
			particle.push([
					[100+Math.floor(Math.random()*100), Math.floor(100+Math.random()*100)],[0,0]
				]);
		}*/
		for ( var n in particle) {
			setPixel(Math.round(particle[n][0][0]), Math.round(particle[n][0][1]), 255, 255, 255, 255);
		}

		ddraws(50)
		//var count = 0;
		function ddraws(counts) {
			for (var x = 0; x < w ; x++)
				for (var y = 0; y < h ; y++) {
					alphap(x, y);
				}

			//generateData();
			c.putImageData(data,25,25);
			//c.clearRect(0, 0, canvas.width, canvas.height);
			//console.log(counts);

			if ( counts > 0)
				setTimeout( function() { ddraws(counts - 1) }, 100 );
			else {

				c.putImageData(data,25,25);
				draws();
			}

		}



	}

	document.getElementById('Canvas').addEventListener('mousemove', mouseMove, true);
	document.getElementById('Canvas').addEventListener('mousedown', mouseDownEvent, false);
	document.getElementById('Canvas').addEventListener('mouseup', mouseUpEvent, false);

	function generateData() {
		for ( var n in particle) {
			setPixel(Math.round(particle[n][0][0]), Math.round(particle[n][0][1]), 0, 0, 0, 255);
			newParticlePosition(particle[n][0][0], particle[n][0][1], n);
			setPixel(Math.round(particle[n][0][0]), Math.round(particle[n][0][1]), 255, 255, 255, 255);
		}
	}

	function newParticlePosition(x, y, n) {

		var dir = Math.atan2(x - mx, y - my) / Math.PI * 180;

		particle[n][1][0] += -Math.sin(dir * Math.PI / 180 ) / 5 ;
		particle[n][1][1] += -Math.cos(dir * Math.PI / 180 ) / 5 ;
		particle[n][0][0] += particle[n][1][0];
		particle[n][0][1] += particle[n][1][1];

		if ( mouseDown ) {
			/*somethin*/
		}
	}

	function setPixel(x, y, r, g, b, a) {
		var pos = x + data.width * y;
		pos *= 4;
		data.data[pos] = r;
		data.data[pos+1] = g; //force green to 0
		data.data[pos+2] = b;
		data.data[pos+3] = a; //force alpha to 100%
	}

	function alphap(x, y) {
		var pos = x * 4 + data.width * y * 4;

		if ( data.data[pos] == 255 || data.data[pos + 3] == 0)
			return;
		//data.data[pos];
		//data.data[pos + 1]; //force green to 0
		//data.data[pos + 2];
		data.data[pos + 3] -=5; //force alpha to 100%
	}

	function getPixel(x, y) {
		var pixel = [];
		var pos = x + data.width * y;
		pos *= 4;
		pixel[0] = data.data[pos];
		pixel[1] = data.data[pos + 1]; //force green to 0
		pixel[2] = data.data[pos + 2];
		pixel[3] = data.data[pos + 3]; //force alpha to 100%
		return pixel;
	}

	function checkPixel(x, y) {
		var pos = (x + data.width * y) * 4 + 3;
		return data.data[pos] != 0;
	}

	function mouseDownEvent() {
		mouseDown = true;
	}

	function mouseUpEvent() {
		mouseDown = false;
	}


	function mouseMove(e) {
		mx = e.clientX-35;
		my = e.clientY-35;
	}

	function draws() {

		generateData();
		c.putImageData(data,25,25);

		//c.clearRect(0, 0, canvas.width, canvas.height);
		setTimeout( function() { draws() }, 1 );
	}

	function remove(id)
	{
	    return (elem=document.getElementById(id)).parentNode.removeChild(elem);
	}

	/*function colorizeImage() {
		var count = 0;
		var img = new Person();
		img.img.src = 'panagora.png';
		var context = document.getElementById('Canvas').getContext('2d');
		context.drawImage(img.img, 0, 0);
		img.imgd = context.getImageData(0, 0, img.img.width, img.img.height);
		var pix = img.imgd.data;
		console.log(img.img.width, img.img.height);
		for (var x = 0; x < img.img.width - 1; x++)
			for (var y = 0; y < img.img.height - 1; y++){
			//	console.log(img.getPixel(x,y));
				//if (img.getPixel(x,y)[0] > 60 && img.getPixel(x,y)[0] < 255)
				if (img.getPixel(x,y)[0] == 255)
					count++;
				//	img.setPixel(x,y,0,0,0,255);
					//img.setPixel(x,y,img.getPixel(x,y)[0]+20,img.getPixel(x,y)[1]+20,img.getPixel(x,y)[2]+20,img.getPixel(x,y)[3]+20);

			}
		context.putImageData(img.imgd, 0, 0);
		console.log(count);
	}

	$(document).ready(function() {
		colorizeImage();
	});

	function Person() {
		this.img = new Image();
		this.imgd;
		this.getPixel = function(x, y) {
			var pixel = [];
			var pos = x + this.img.width * y;
			pos *= 4;
			pixel[0] = this.imgd.data[pos];
			pixel[1] = this.imgd.data[pos + 1]; //force green to 0
			pixel[2] = this.imgd.data[pos + 2];
			pixel[3] = this.imgd.data[pos + 3]; //force alpha to 100%
			return pixel;
		}

		this.setPixel = function(x, y, r, g, b, a) {
			var pos = x + this.img.width * y;
			pos *= 4;
			this.imgd.data[pos] = r;
			this.imgd.data[pos+1] = g; //force green to 0
			this.imgd.data[pos+2] = b;
			this.imgd.data[pos+3] = a; //force alpha to 100%
		}

		this.img.onload = xxx();
	}

	function xxx() {
       		//alert ("The image has loaded!");
		};


	function list() {
  		return Array.prototype.slice.call(arguments);
	}*/
</script>
